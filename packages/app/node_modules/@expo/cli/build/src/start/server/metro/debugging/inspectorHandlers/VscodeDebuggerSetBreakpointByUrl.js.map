{"version":3,"sources":["../../../../../../../src/start/server/metro/debugging/inspectorHandlers/VscodeDebuggerSetBreakpointByUrl.ts"],"sourcesContent":["import Protocol from 'devtools-protocol';\n\nimport { CdpMessage, DebuggerMetadata, DebuggerRequest, InspectorHandler } from './types';\nimport { getDebuggerType } from './utils';\n\n/**\n * Hermes and vscode have trouble setting breakpoints by `urlRegex` through `Debugger.setBreakpointByUrl`.\n * Vscode adds `file://` to a URL containing `http://`, which confuses Hermes and sets it to the wrong location.\n * Hermes needs to create the breakpoint to get the proper ID, but it must be unbounded.\n * Once the sourcemap is loaded, vscode will rebind the unbounded breakpoint to the correct location (using `Debugger.setBreakpoint`).\n */\nexport class VscodeDebuggerSetBreakpointByUrlHandler implements InspectorHandler {\n  onDebuggerMessage(\n    message: DebuggerRequest<DebuggerSetBreakpointByUrl>,\n    { userAgent }: DebuggerMetadata\n  ): boolean {\n    if (\n      getDebuggerType(userAgent) === 'vscode' &&\n      message.method === 'Debugger.setBreakpointByUrl' &&\n      message.params.urlRegex\n    ) {\n      // Explicitly force the breakpoint to be unbounded\n      message.params.url = 'file://__invalid_url__';\n      delete message.params.urlRegex;\n    }\n\n    return false;\n  }\n}\n\n/** @see https://chromedevtools.github.io/devtools-protocol/v8/Debugger/#method-setBreakpointByUrl */\nexport type DebuggerSetBreakpointByUrl = CdpMessage<\n  'Debugger.setBreakpointByUrl',\n  Protocol.Debugger.SetBreakpointByUrlRequest,\n  Protocol.Debugger.SetBreakpointByUrlResponse\n>;\n"],"names":["VscodeDebuggerSetBreakpointByUrlHandler","onDebuggerMessage","message","userAgent","getDebuggerType","method","params","urlRegex","url"],"mappings":"AAAA;;;;AAGgC,IAAA,MAAS,WAAT,SAAS,CAAA;AAQlC,MAAMA,uCAAuC;IAClDC,iBAAiB,CACfC,OAAoD,EACpD,EAAEC,SAAS,CAAA,EAAoB,EACtB;QACT,IACEC,CAAAA,GAAAA,MAAe,AAAW,CAAA,gBAAX,CAACD,SAAS,CAAC,KAAK,QAAQ,IACvCD,OAAO,CAACG,MAAM,KAAK,6BAA6B,IAChDH,OAAO,CAACI,MAAM,CAACC,QAAQ,EACvB;YACA,kDAAkD;YAClDL,OAAO,CAACI,MAAM,CAACE,GAAG,GAAG,wBAAwB,CAAC;YAC9C,OAAON,OAAO,CAACI,MAAM,CAACC,QAAQ,CAAC;SAChC;QAED,OAAO,KAAK,CAAC;KACd;CACF;QAjBYP,uCAAuC,GAAvCA,uCAAuC"}