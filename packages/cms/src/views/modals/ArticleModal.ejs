<!-- Modal -->
<div
  class="modal fade bd-example-modal-lg"
  id="articleModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="dynamicModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="dynamicModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-borderless modal-table">
          <thead>
            <tr>
              <th style="width: 20%"><%= __('Category')%></th>
              <th style="width: 20%"><%= __('Subcategory')%></th>
              <th style="width: 20%"><%= __('Article Title')%> </th>
              <th style="width: 40%"><%= __('Article Content')%> </th>
              <th style="width: 40%"><%= __('Filter')%> </th>
              <th style="width: 40%"><%= __('Age Restriction')%> </th>
              <th style="width: 10%"><%= __('Live')%></th>
            </tr>
          </thead>
          <tbody style="overflow-y: scroll; align-items: center;">
            <td style="width: 10%">
              <select class="custom-select" id="col0TableModal">
                <% categories.forEach((item, index) =>{ %>
                <option value="<%-item.id%>"><%= item.title %></option>
                <% }) %>
              </select>
              <p id="error1" style="display: none;">required field</p>
            </td>
            <td style="width: 10%">
              <select class="custom-select" id="col1TableModal">
                <% subcategories.forEach((item, index) =>{ %>
                  <option value="<%-item.id%>" data-id="<%-item.parent_category%>"><%= item.title %></option>
                  <% }) %>
              </select>
              <p id="error2" style="display: none;">required field</p>
            </td>
            <td style="width: 10%">
              <textarea class="form-control" rows="8" id="col2TableModal"></textarea>
              <p id="countdown2">remaining</p>
              <p id="errorTitle2" style="display: none;">title is already exist</p>
              <p id="error3" style="display: none;">max 70 characters</p>
            </td>
            <td style="width: 10%">
              <textarea class="form-control" id="col3TableModal" cols="45" rows="15"></textarea>
              <p id="error4" style="display: none;">required field</p>
            </td>
            
            <td>
              <select 
                id="contentFilterDropdownForm"
                class="contentFilterDropdown"
                data-source="article"
              >
              <% contentFilterOptions.forEach((item) =>{ %>
                <option value="<%-item.value%>"><%-item.description%></option>
              <% }) %>
            </select>
          </td>
          <td>
            <select class="ageRestrictionLevel" id="ageRestrictionLevelForm" data-source="article">
                <% ageRestrictionOptions.forEach((item) =>{ %>
                  <option value="<%-item.value%>"><%-item.description%></option>
                <% }) %>
            </select>
          </td>
          
            <td >
                <label class="switch">
                  <input id="col4TableModal" type="checkbox">
                  <span class="slider round"></span>
                </label>
              </td>
          </tbody>
        </table>

        <!-- Province Restriction Section -->
        <div class="form-group">
          <label><%= __('Province Restrictions')%></label>
          <div class="custom-control custom-checkbox">
            <input 
              type="checkbox" 
              class="custom-control-input" 
              id="provinceRestricted" 
              name="provinceRestricted"
            >
            <label class="custom-control-label" for="provinceRestricted">
              <%= __('Restrict to specific provinces')%>
            </label>
            <small class="form-text text-muted">
              <%= __('When enabled, this content will only be visible to users from selected provinces.')%>
            </small>
          </div>
        </div>

        <!-- Country Selector (shows when restriction is enabled) -->
        <div class="form-group" id="countrySelector" style="display: none;">
          <label><%= __('Select Countries')%></label>
          <select 
            id="allowedCountriesSelect" 
            multiple 
            class="form-control" 
            size="8"
            style="height: 150px;"
          >
            <% 
              const userLang = (typeof currentUser !== 'undefined' && currentUser && currentUser.lang) ? currentUser.lang : 'en';
              const countryList = [];
              const seenCountries = new Set();
              
              if (typeof provinces !== 'undefined' && Array.isArray(provinces)) {
                provinces.forEach(function(province) {
                  if (!seenCountries.has(province.code) && province.code !== '00') {
                    seenCountries.add(province.code);
                    const countryName = (typeof countries !== 'undefined' && countries[province.code]) 
                      ? (countries[province.code][userLang] || countries[province.code]['en']) 
                      : province.code;
                    countryList.push({ code: province.code, name: countryName });
                  }
                });
                countryList.sort((a, b) => a.name.localeCompare(b.name));
                countryList.forEach(function(country) { 
            %>
              <option value="<%= country.code %>">
                <%= country.name %> (<%= country.code %>)
              </option>
            <% 
                });
              }
            %>
          </select>
          <small class="form-text text-muted">
            <%= __('Hold Ctrl (Cmd on Mac) to select multiple countries. Select countries first, then provinces will appear below.')%>
          </small>
        </div>

        <!-- Province Selector (shows provinces from selected countries) -->
        <div class="form-group" id="provinceSelector" style="display: none;">
          <label><%= __('Select Provinces')%></label>
          <select 
            name="allowedProvinces" 
            id="allowedProvincesSelect" 
            multiple 
            class="form-control" 
            size="10"
            style="height: 200px;"
          >
            <% 
              const userLang2 = (typeof currentUser !== 'undefined' && currentUser && currentUser.lang) ? currentUser.lang : 'en';
              if (typeof provinces !== 'undefined' && Array.isArray(provinces)) {
                provinces.forEach(function(province) { 
                  if (province.code !== '00') {
                    const provinceName = province[userLang2] || province['en'];
            %>
              <option 
                value="<%= province.uid %>" 
                data-country="<%= province.code %>"
              >
                <%= province.code %> - <%= provinceName %>
              </option>
            <% 
                  }
                });
              }
            %>
          </select>
          <small class="form-text text-muted">
            <%= __('Hold Ctrl (Cmd on Mac) to select multiple provinces.')%>
          </small>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"><%= __('Close')%></button>
        <button type="submit" class="btn btn-primary" id="btnArticleEditConfirm"><%= __('Confirm')%></button>
      </div>
    </div>
  </div>
  <span id="itemID" hidden></span>
</div>

<!-- modal confirmation row reorder -->
<div class="modal fade" tabindex="-1" role="dialog" id="rowReorderModal">
  <div class="modal-dialog modal-lg" style="min-width: unset; text-align: initial;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Are you sure you want to reorder?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="rowReorderConfirmationBody">
        <p>Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="saveReorder(1)">Save changes</button>
        <button type="button" class="btn btn-secondary" onclick="saveReorder(0)" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>